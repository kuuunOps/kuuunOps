# 资源监控与日志收集

# 资源监控

>Kubernetes官方文献：https://kubernetes.io/zh/docs/tasks/debug-application-cluster/resource-metrics-pipeline/
>
>GitHub文献：https://github.com/kubernetes-sigs/metrics-server

资源使用指标，例如容器 CPU 和内存使用率，可通过 Metrics API 在 Kubernetes 中获得。 这些指标可以直接被用户访问，比如使用` kubectl top `命令行，或者被集群中的控制器 （例如 Horizontal Pod Autoscalers) 使用来做决策。

## Metrics服务器

```shell
kubectl apply -f https://github.com/kubernetes-sigs/metrics-server/releases/latest/download/components.yaml
```

| 配置选项                          | 描述                                                                                                   |
| --------------------------------- | ------------------------------------------------------------------------------------------------------ |
| --kubelet-preferred-address-types | 确定连接到特定节点的地址时使用的节点地址类型的优先级（默认[主机名，内部DNS，内部IP，外部DNS，外部IP]） |
| --kubelet-insecure-tls            | 不要验证Kubelets提供的服务证书的CA。                                                                   |
| --requestheader-client-ca-file    | 指定根证书捆绑包，以验证传入请求上的客户端证书。                                                       |

调整配置
```yaml
... ...
    spec:
      containers:
      - args:
        - --cert-dir=/tmp
        - --secure-port=4443
        - --kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname
        # 配置跳过TLS证书验证
        - --kubelet-insecure-tls
        - --kubelet-use-node-status-port
        # 配置非Google镜像地址
        image: bitnami/metrics-server:0.4.2
... ...
```

---

# 日志收集

## 标准输出

## 日志文件